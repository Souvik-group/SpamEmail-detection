<!DOCTYPE html>
<html>
<head>
    <title>Spam Email Detector</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Spam Email Detector</h1>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('single')">Single Message</button>
            <button class="tab-btn" onclick="showTab('batch')">Batch Upload</button>
        </div>
        
        <div id="single" class="tab-content active">
            <form id="spamForm">
                <textarea id="message" placeholder="Enter email message here..." required></textarea>
                <button type="submit">Check Email</button>
            </form>
            <div id="result"></div>
        </div>
        
        <div id="batch" class="tab-content">
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="file-upload">
                    <input type="file" id="csvFile" accept=".csv,.eml" required>
                    <label for="csvFile">Choose CSV or EML File</label>
                    <p>CSV: must have 'message' column<br>EML: email message files</p>
                </div>
                <button type="submit">Process File</button>
            </form>
            <div id="batchResult"></div>
        </div>
    </div>

    <script>
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
        }
        
        document.getElementById('spamForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const message = document.getElementById('message').value;
            const formData = new FormData();
            formData.append('message', message);
            
            document.getElementById('result').innerHTML = '<p>Processing...</p>';
            
            try {
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.error) {
                    document.getElementById('result').innerHTML = `<p class="error">${result.error}</p>`;
                } else {
                    document.getElementById('result').innerHTML = 
                        `<h3>Result: ${result.prediction}</h3><p>Confidence: ${result.confidence}</p>`;
                }
            } catch (error) {
                document.getElementById('result').innerHTML = '<p class="error">Error processing request</p>';
            }
        });
        
        document.getElementById('uploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const file = document.getElementById('csvFile').files[0];
            const formData = new FormData();
            formData.append('file', file);
            
            document.getElementById('batchResult').innerHTML = '<p>Processing...</p>';
            
            try {
                const response = await fetch('/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.error) {
                    document.getElementById('batchResult').innerHTML = `<p class="error">${result.error}</p>`;
                } else {
                    let html = `<div class="summary">
                        <h3>Summary</h3>
                        <p>Total: ${result.summary.total} | Spam: ${result.summary.spam} | Not Spam: ${result.summary.not_spam}</p>
                    </div><div class="results-table">`;
                    
                    result.results.forEach(r => {
                        html += `<div class="result-row ${r.prediction === 'Spam' ? 'spam' : 'not-spam'}">
                            <span class="row-num">${r.row}</span>
                            <span class="message">${r.message}</span>
                            <span class="prediction">${r.prediction}</span>
                            <span class="confidence">${r.confidence}</span>
                        </div>`;
                    });
                    
                    html += '</div>';
                    document.getElementById('batchResult').innerHTML = html;
                }
            } catch (error) {
                document.getElementById('batchResult').innerHTML = '<p class="error">Error processing file</p>';
            }
        });
    </script>
</body>
</html>